## 单例模式的基本实现

参考四种实现方式：<https://www.cnblogs.com/yxi-liu/p/singleton.html> 

```python
class SingletonType(type):
    _instances = {}

    def __call__(cls, *args, **kwargs):
        if cls not in cls._instances:
            cls._instances[cls] = super(SingletonType, cls).__call__(*args, **kwargs)
        return cls._instances[cls]

def singleton(cls):
    instances = {}

    def _singleton(*args, **kwargs):
        if cls not in instances:
            instances[cls] = cls(*args, **kwargs)
        return instances[cls]

    return _singleton

class A(metaclass=SingletonType):
    pass

@singleton
class B:
    pass

class C:
    pass

if __name__ == '__main__':
    print(A() is A())
    print(B() is B())
    print(C() is C())
```



## 单例模式实现的日志

```python
"""
我们的目的是借助单例模式，只生成一个logger。
"""
import logging
import os
import time
import sys


class SingletonType(type):
    _instances = {}

    def __call__(cls, *args, **kwargs):
        if cls not in cls._instances:
            cls._instances[cls] = super(SingletonType, cls).__call__(*args, **kwargs)
        return cls._instances[cls]


class Logger(metaclass=SingletonType):
    """ Logger的__new__只在创建第一个实例的时候被调用 """
    def __new__(cls, log_file=None):
        """ 我们要返回的不是Logger类实例，而是使用内置logging模块创建的实例 """
        # 日志文件的路径
        if log_file is None:
            # 文件的当前目录
            current_path = os.path.dirname(os.path.realpath(__file__))
            current_time = time.strftime("%Y-%m-%d-%H%M%S", time.localtime())
            log_file = os.path.join(current_path, 'log_output', f'{current_time}.txt')
            os.makedirs(os.path.dirname(log_file), exist_ok=True)

        cls.logger = logging.getLogger(__name__)
        formater = logging.Formatter('%(asctime)s %(name)s [%(filename)s %(lineno)s] %(message)s')
        # 标准输出
        standard_out = logging.StreamHandler(sys.stdout)
        standard_out.setFormatter(formater)
        cls.logger.addHandler(standard_out)    # 添加标准输出
        # 日志文件输出
        file_out = logging.FileHandler(log_file)
        file_out.setFormatter(formater)
        cls.logger.addHandler(file_out)    # 添加文件输出
        cls.logger.setLevel(logging.INFO)
        return cls.logger


if __name__ == '__main__':
    logger = Logger("Logger1")  # 只第一个名称有效
    logger2 = Logger("Logger2")
    logger3 = Logger("Logger3")
    logger.info("This is a info")
    print(logger is logger2, logger2 is logger3)

```



